<?php

class fixit_terms{
		
	public function main(){
		$fTerms = $this->get_fixit_terms_from_db();
	
	return $fTerms;
	}

	private function get_fixit_terms_from_db(){
	$exist = 0;
	$job_statuses = array(
						'need_zip' => 0,
						'needs_approval' => 0,
						'approved' => 0,
						'denied' => 0,
						'taken_not_notified_customer' => 0,
						'taken_notified_customer' => 0,
						'taken_details_sent_to_fixit' => 0,
						'feedback_requested' => 0);
	$text_out_types = array(
						'request_zip' => 0,
						'notify_customer_job_is_taken' => 0,
						'relay_to_fixit' => 0,
						'request_approval' => 0,
						'request_feedback' => 0,
						'send_details_to_fixit' => 0);
	$person_types = array(
						'customer' => 0,
						'fixit' => 0,
						'spammer' => 0);

	$fTerms = array(
						'exist' => 0,
						'job_statuses' => $job_statuses,
						'text_out_types' => $text_out_types,
						'person_types' => $person_types);

	$sql =	"select		tv.vid,
						tv.name as vocab,
						td.tid as term_ref,
						td.name as term
			from		taxonomy_vocabulary tv
			join		taxonomy_term_data td on td.vid = tv.vid
			where		tv.name = 'job_statuses'
			or			tv.name = 'person_types'
			or			tv.name = 'text_out_types'";
	
	$results = db_query($sql);

	//Copy the taxonomy term target IDs to overwrite the zeros
	foreach($results as $r){
		$fTerms[$r->vocab][$r->term] = $r->term_ref;
	}
	
	//Check to make sure there are no zeros left
	$fTerms = $this->check_for_zeros($fTerms);

	return $fTerms;					
	}

	private function check_for_zeros($fTerms){
		foreach($fTerms as $i){
			if($i == 'exist') continue;
			foreach($i as $j){
				if($j === 0) return $fTerms;
			}
		}
	$fTerms['exist'] = 1;
	return $fTerms;
	}
}